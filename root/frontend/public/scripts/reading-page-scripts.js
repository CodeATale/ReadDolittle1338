// **This function should probably be simplified/reworked.**
function updatePageText (num) {
    fetch("../../assets/json_files/parsedPages.json")
        .then((Response) => Response.json())
        .then((data) => {
            let str = data[parseInt(num, 10)]
                .toString()
                .replace(/,/g, " ")
                .split(/\s+/)
                .map((w) => `<span class="highlight">${w}</span>`); // Note this removes all commas everywhere, which we don't want.

            str = str.toString().replace(/,/g, " "); // Note this is also needed to remove the commas that are generated by .split(" ")

            $(".main-text").html(str);

            // Adds on click funtion for each word individually
            $(".highlight").each(function() {
                $(this).click(function() {
                    alert($(this).text());
                });
            });
        });
}

$("document").ready(function() {
    let chapterNum = sessionStorage.getItem("chptNum");
    $("#reading-heading").text(`Chapter ${chapterNum}`);
    $("img").attr("src", `../../assets/chapter_images/chapter${chapterNum}.png`);
    updatePageText(sessionStorage.getItem("chptNum")-1);
});

const prevPage = $("#prevPg");
prevPage.click(() => {
    let num = sessionStorage.getItem("chptNum");
    if (num <= 1) {return;}
    num =  parseInt(num, 10) - 1;
    $("img").attr("src", `../../assets/chapter_images/chapter${num}.png`); // Changes the chapter image
    $("#reading-heading").html(`Chapter ${num}`); // Changes the title of the chapter
    sessionStorage.setItem("chptNum", num);
    updatePageText(num-1);
});

const nextPage = $("#nextPg");
nextPage.click(() => {
    let num = sessionStorage.getItem("chptNum");
    if (num >= 21) {return;}
    num = parseInt(num, 10) + 1;
    $("img").attr("src", `../../assets/chapter_images/chapter${num}.png`); // Changes the chapter image
    $("#reading-heading").html(`Chapter ${num}`); // Changes the title of the chapter
    sessionStorage.setItem("chptNum", num);
    updatePageText(num-1);
});

