// Maybe don't want to load this every time
let text;
fetch("../../assets/json_files/parsedPages.json")
  .then((Response) => Response.json())
  .then((data) => {
    text = data;
  });

// **This function should probably be simplified/reworked.**
function updatePageText (chapter, page) {
  let str = text[chapter][page]
    .toString()
    .replace(/,/g, " ")
    .split(/\s+/)
    .map((w) => `<span class="highlight">${w}</span>`); // Note this removes all commas everywhere, which we don't want.

  str = str.toString().replace(/,/g, " "); // Note this is also needed to remove the commas that are generated by .split(" ")

  $(".main-text").html(str);

  // Adds on click funtion for each word individually
  $(".highlight").each(function() {
    $(this).click(function() {
      alert($(this).text());
    });
  });
}

$("document").ready(function() {
    let chapterNum = sessionStorage.getItem("chptNum");
    $("#reading-heading").text(`Chapter ${chapterNum}`);
    // $("img").attr("src", `../../assets/chapter_images/chapter${chapterNum}.png`);
    updatePageText(chapterNum-1, sessionStorage.getItem("pageNum"));
});

const prevPage = $("#prevPg");
prevPage.click(() => {
  let chapterNum = parseInt(sessionStorage.getItem("chptNum"), 10);
  let pageNum = parseInt(sessionStorage.getItem("pageNum"), 10);

  if (pageNum <= 0) {
    chapterNum = chapterNum - 1;
    pageNum = text[chapterNum].length - 1;
  } else {
    pageNum--;
  }

  if (chapterNum <= 0) {return;}

  // $("img").attr("src", `../../assets/chapter_images/chapter${chapterNum}.png`); // Changes the chapter image
  $("#reading-heading").html(`Chapter ${chapterNum}`); // Changes the title of the chapter
  sessionStorage.setItem("chptNum", chapterNum);
  sessionStorage.setItem("pageNum", pageNum);
  updatePageText(chapterNum, pageNum);
});

const nextPage = $("#nextPg");
nextPage.click(() => {
  let chapterNum = parseInt(sessionStorage.getItem("chptNum"), 10);
  let pageNum = parseInt(sessionStorage.getItem("pageNum"), 10);

  if (pageNum + 1 >= text[chapterNum].length) {
    chapterNum++;
    pageNum = 0;
  } else {
    pageNum++;
  }

  if (chapterNum >= 21) {return;}
  
  // $("img").attr("src", `../../assets/chapter_images/chapter${num}.png`); // Changes the chapter image
  $("#reading-heading").html(`Chapter ${num}`); // Changes the title of the chapter
  sessionStorage.setItem("chptNum", chapterNum);
  sessionStorage.setItem("pageNum", pageNum);
  updatePageText(chapterNum, pageNum);
});
