// window.addEventListener('load', () => {
//     document.querySelector('#reading-heading').innerHTML = 'Chapter ' + sessionStorage.getItem('chptNum');
//     document.querySelector("img").src = "../assets/chapter_images/chapter" + sessionStorage.getItem("chptNum") + ".png";
//     updatePageText(sessionStorage.getItem('chptNum')-1);
// })

$("document").ready(function() {
    $("#reading-heading").text("Chapter " + sessionStorage.getItem("chptNum"));
    $("img").attr("src", "../assets/chapter_images/chapter" + sessionStorage.getItem("chptNum") + ".png");
    updatePageText(sessionStorage.getItem('chptNum')-1);
})

const nextPage = $("#prevPg");
nextPage.click(() => {
    let num = sessionStorage.getItem('chptNum')
    if (num <= 1) return;
    num =  parseInt(num) - 1;
    addImage("../assets/chapter_images/chapter" + num + ".png");
    changePageTitle('Chapter ' + num);
    sessionStorage.setItem('chptNum', num);

    updatePageText(num-1);
})

const prevPage = $("#nextPg");
prevPage.click(() => {
    let num = sessionStorage.getItem('chptNum')
    if (num == 21) return;
    num = parseInt(num) + 1;
    addImage("../assets/chapter_images/chapter" + num + ".png");
    changePageTitle('Chapter ' + num);
    sessionStorage.setItem('chptNum', num);
    updatePageText(num-1);
})

const changePageTitle = (newTitle) => {
    let header = $("#reading-heading");
    header.html(newTitle);
}

const changePageText = (num) => {
    $(".main-text").html(' |Temp Text For Page| ' + num);
}

const addImage = (srcPath) => {
    $("img").attr("src", srcPath);
}

function updatePageText (num) {
    fetch("parsedPages.json")
        .then(Response => Response.json())
        .then(data => {
            let str = data[num]
                .toString()
                .replace(/,/g, " ")
                .split(/\s+/)
                .map(w => `<span class="highlight">${w}</span>`); // Note this removes all commas everywhere, which we don't want.
            
            str = str.toString().replace(/,/g, " "); // Note this is also needed to remove the commas that are generated by .split(" ")

            $(".main-text").html(str);

            document.querySelectorAll(".highlight").forEach((e) => { 
                e.addEventListener("click", () => {
                    alert(e.innerHTML);
                });
            });

            increaseChapterNumber(str)

        });
}

function increaseChapterNumber (text) {
    if (text.toLowerCase().indexOf("chapter") !== -1) {
        let num = sessionStorage.getItem('chptNum')
        num = parseInt(num) + 1
        sessionStorage.setItem('chptNum', num)
        console.log(num)
    }
}

